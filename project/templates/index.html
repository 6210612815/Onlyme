<html>
    <body>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script src="https://static.line-scdn.net/liff/edge/versions/2.9.0/sdk.js"></script>
        <script>
            liff.init({ liffId: "1657196715-wb3NDYPR" }, () => {
                if (!liff.isLoggedIn()) {
                    liff.login();
                } else {
                    const accessToken = liff.getAccessToken();
                    
                    let data = {                    
                        'access_token': accessToken,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    }
                    $.ajax({
                        type: "POST",
                        url: "https://ba9c-124-122-222-45.ap.ngrok.io/lineapi/",
                        data: data,
                        dataType: 'JSON',
                        success: function (data) {
                            if (data.in_db) {
                                window.location.href = "https://ba9c-124-122-222-45.ap.ngrok.io/homepage";
                            }else{
                                window.location.href = "https://ba9c-124-122-222-45.ap.ngrok.io/register";
                            }
                        }
                    });
                }
            }, err => console.error(err.code, error.message));
        </script>
    </body>
</html>
